

<p id="counter"></p>


<div id="googleMap" style="width:100%;height:500px;"></div>

<script src="http://maps.googleapis.com/maps/api/js"></script>
<script>

var map;
var directionsDisplay;
var directionsService = new google.maps.DirectionsService();

var marker;
var infowindow;
var myCenter=new google.maps.LatLng("<%=@lat%>", "<%=@lng%>");
var last_point;
var start = new google.maps.LatLng(31.528854654816588, 74.28192257881165);
var end = new google.maps.LatLng(31.525727008258347, 74.27833914756775);


function initialize(){
  // For directions
  directionsDisplay = new google.maps.DirectionsRenderer({suppressMarkers: true});
  
var mapProp = {
  center:myCenter,
  zoom:5,
  mapTypeId:google.maps.MapTypeId.ROADMAP
  };

  map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

placeMarker(myCenter);

}
// setTimeout(function(){ calcRoute(start, end) }, 5000);


google.maps.event.addDomListener(window, 'load', initialize);

var i =0
var max_seconds = 7
// var myVar = setTimeout(function(){ showTimer() }, 7000);
var myVar = setInterval(function(){ showTimer() }, 1000);

function showTimer() {
  // get_last_location();
    $('#counter').html(++i);
    if (i == max_seconds) {
      i = 0
      get_last_location();
    }
}

function get_last_location(){
  $.ajax({
        url: '/locations/get_last_location',
        method: 'POST',
        success: function(data) {
          dd = data
           last_point =new google.maps.LatLng(data.lat, data.lng);
           // moveMarker(map, marker, last_point)
           calcRoute(start, last_point)

        }
      });
}










</script>
