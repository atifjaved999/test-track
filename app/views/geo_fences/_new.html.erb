
<span id="info"></span>
<div class="row">
  <div class="col-md-12">
    <!-- BEGIN BASIC PORTLET-->
    <div class="portlet box blue">
      <div class="portlet-title">
        <div class="caption">
          <i class="fa fa-gift"></i>New GeoFence
        </div>
        <div class="tools">
          <a href="javascript:;" class="collapse">
          </a>
          <a href="#portlet-config" data-toggle="modal" class="config">
          </a>
          <a href="javascript:;" class="reload">
          </a>
          <a href="javascript:;" class="remove">
          </a>
        </div>
      </div>
      <div class="portlet-body form">
        <div id="googleMap" style="width:100%;height:400px;">
        </div>
        <div class="form-actions fluid">
          <div class="row">
            <div class="col-md-offset-4 col-md-9 geo_fence_form">
              <div class="col-md-3">
                <input id="geo_fence_name" type="text" class="form-control" placeholder="Name" />
              </div>
              <div class="col-md-3">
                <input id="geo_fence_type" type="text" class="form-control" placeholder="Type" />
              </div>
<!--               <div class="col-md-3">
                <input type="text" class="form-control" name="Enabled" />
              </div> -->
              <button type="button" class="btn green" onclick="saveGeoFence();">Save</button>
              <a class="btn default" href="<%=new_geo_fence_path%>" data-no-turbolink=true>
                Cancel
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- END BASIC PORTLET-->
  </div>
</div>


<script>

  var map;
  var marker;
  var infowindow;
  var start = new google.maps.LatLng(31.528854654816588, 74.28192257881165);
  var end = new google.maps.LatLng(31.525727008258347, 74.27833914756775);

  function initialize(){

    
  var mapProp = {
    center:new google.maps.LatLng(33.5190755, -111.9253654),
    zoom:12,
    mapTypeId:google.maps.MapTypeId.ROADMAP
    };

    map = new google.maps.Map(document.getElementById("googleMap"),mapProp);

    // Polygon Coordinates
    var triangleCoords = [
      new google.maps.LatLng(33.5362475, -111.9267386),
      new google.maps.LatLng(33.5104882, -111.9627875),
      new google.maps.LatLng(33.5004686, -111.9027061)
    ];
    // Styling & Controls
    myPolygon = new google.maps.Polygon({
      paths: triangleCoords,
      draggable: true, // turn off if it gets annoying
      editable: true,
      strokeColor: '#FF0000',
      strokeOpacity: 0.8,
      strokeWeight: 2,
      fillColor: '#FF0000',
      fillOpacity: 0.35
    });

    myPolygon.setMap(map);
    //google.maps.event.addListener(myPolygon, "dragend", getPolygonCoords);
    google.maps.event.addListener(myPolygon.getPath(), "insert_at", getPolygonCoords);
    //google.maps.event.addListener(myPolygon.getPath(), "remove_at", getPolygonCoords);
    google.maps.event.addListener(myPolygon.getPath(), "set_at", getPolygonCoords);

  }

  google.maps.event.addDomListener(window, 'load', initialize);

  var coordinates_array = []

  //Display Coordinates below map
  function getPolygonCoords() {
        coordinates_array = []
    var len = myPolygon.getPath().getLength();
    var htmlStr = "";
    for (var i = 0; i < len; i++) {
      // htmlStr += "new google.maps.LatLng(" + myPolygon.getPath().getAt(i).toUrlValue(5) + "), ";
      //Use this one instead if you want to get rid of the wrap > new google.maps.LatLng(),
      htmlStr += " " + myPolygon.getPath().getAt(i).toUrlValue(8);
        coordinates_array.push(myPolygon.getPath().getAt(i).toUrlValue(8))
    }
    document.getElementById('info').innerHTML = htmlStr;
  }

  function saveGeoFence(){
    var name = $("#geo_fence_name").val();
    var type = $("#geo_fence_type").val();
    var inputs = $(".geo_fence_form").find('input');
    var errors = check_validation_errors(inputs)
    if (!errors) {
      $.ajax({
            url: '/geo_fences',
            data: {"coordinates_array": coordinates_array, "name":name, "geo_fence_type":type},
            method: 'POST',
            success: function(data) {
              // alert("Created..!!");
            }
          });
      }
  }







</script>